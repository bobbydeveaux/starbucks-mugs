{
  "prTitle": "fix: address WebSocket handler and gRPC service review feedback",
  "prBody": "## Summary\n\nThis PR addresses all blocking and non-blocking issues raised in code review of PR #236 (AlertService RPCs) and the WebSocket upgrade handler:\n\n### Blocking Issues Fixed\n\n**1. WebSocket server crash via oversized frame (int64 overflow)**\n- `internal/server/websocket/handler.go`: Added `maxFrameSize` (64 KiB) constant and guards `rawLen > maxFrameSize` check *before* converting `uint64` to `int64`, preventing the overflow-to-negative that caused `make([]byte, length)` to panic\n- Replaced `make([]byte, length)` allocation with `io.CopyN(io.Discard, buf, length)` to avoid memory exhaustion\n- Added `recover()` to the `readLoop` goroutine so any future panic cannot crash the server process\n\n**2. `RegisterAgent` now returns a stable `host_id` across reconnects**\n- `internal/server/storage/postgres.go`: `UpsertHost` uses `RETURNING host_id` so the pre-existing UUID is returned on hostname conflict, not the freshly-generated candidate\n- `internal/server/grpc/alert_service.go`: `Store.UpsertHost` interface updated to return `(string, error)`; `RegisterAgent` uses the `effectiveHostID` in the response\n\n### Non-Blocking Issues Addressed\n\n**3. `stream.Recv()` error handling distinguishes transport errors**\n- `StreamAlerts` now checks `ctx.Err()` to distinguish clean context cancellation (logged at Debug) from transport/auth errors (logged at Warn and returned as non-nil)\n\n**4. WebSocket endpoint authentication documented**\n- `Handler` godoc explains the reverse-proxy deployment model and guidance for adding token validation when running without a proxy\n\n**5. Test compilation failure in `process_watcher_test.go`**\n- Added `noopLogger()` directly to `process_watcher_test.go` (package `watcher`) since it cannot inherit from `file_test.go` (package `watcher_test`)\n\nCloses #228",
  "testsPass": true,
  "filesChanged": [
    "internal/server/websocket/handler.go",
    "internal/server/grpc/alert_service.go",
    "internal/server/storage/postgres.go",
    "internal/watcher/process_watcher_test.go",
    "docs/concepts/tripwire-cybersecurity-tool/grpc-alert-service.md"
  ],
  "docsUpdated": [
    "docs/concepts/tripwire-cybersecurity-tool/grpc-alert-service.md"
  ],
  "docsReviewed": [
    "docs/concepts/tripwire-cybersecurity-tool/grpc-alert-service.md",
    "docs/concepts/tripwire-cybersecurity-tool/LLD.md",
    "docs/concepts/tripwire-cybersecurity-tool/README.md"
  ],
  "completedTasks": [1, 2, 3, 4, 5]
}
