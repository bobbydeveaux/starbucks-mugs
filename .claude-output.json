{
  "prTitle": "fix: address code review - WebSocket frame overflow, stable host_id, stream error handling",
  "prBody": "## Summary\n\nAddresses all blocking and non-blocking issues raised in PR #236 code review.\n\n### Blocking fixes\n\n**WebSocket oversized frame crash** (`internal/server/websocket/handler.go`)\n- Added `maxFrameSize = 64 KiB` constant; `readLoop` now rejects any client frame whose 8-byte extended payload length exceeds this limit, preventing both the `int64` overflow (values > `math.MaxInt64` wrap to negative, causing `make([]byte, n)` to panic) and memory exhaustion from large frames\n- Replaced `make([]byte, length)` + `buf.Read` with `io.CopyN(io.Discard, buf, length)` to discard payloads in small chunks without large allocations\n- Added `recover()` inside the `readLoop` goroutine as defence-in-depth so a panic cannot crash the entire server process\n\n**Unstable `host_id` on reconnect** (`internal/server/storage/postgres.go`, `internal/server/grpc/server.go`)\n- Changed `UpsertHost` to use `RETURNING host_id` so the SQL returns the _existing_ `host_id` on hostname conflict instead of the caller-supplied candidate UUID\n- `RegisterAgent` now uses the returned effective `host_id` in the `RegisterResponse`, guaranteeing agents receive the same stable UUID on every reconnect\n- Updated `Store` interface, `fakeStore`, and all integration test call-sites for the new `(string, error)` signature\n- Added `TestRegisterAgent_StableHostIDOnReconnect` to verify the invariant\n\n### Non-blocking fixes\n\n**`stream.Recv()` error swallowing** (`internal/server/grpc/server.go`)\n- `io.EOF`, `context.Canceled`, `context.DeadlineExceeded`, and gRPC `Canceled`/`DeadlineExceeded` status codes are treated as normal stream closure and return `nil`\n- All other errors are logged at `Error` level and returned so the gRPC runtime can surface them\n\n### Documentation updated\n\n- `docs/concepts/tripwire-cybersecurity-tool/grpc-alert-service.md`: corrected the `host_id` stability description, updated the `StreamAlerts` error-handling section, added a Security Notes section documenting the frame-size guard and WebSocket authentication assumptions\n\nCloses #180",
  "testsPass": true,
  "filesChanged": [
    "internal/server/websocket/handler.go",
    "internal/server/grpc/server.go",
    "internal/server/grpc/server_test.go",
    "internal/server/storage/postgres.go",
    "internal/server/storage/postgres_test.go",
    "docs/concepts/tripwire-cybersecurity-tool/grpc-alert-service.md"
  ],
  "docsUpdated": [
    "docs/concepts/tripwire-cybersecurity-tool/grpc-alert-service.md"
  ],
  "docsReviewed": [
    "docs/concepts/tripwire-cybersecurity-tool/HLD.md",
    "docs/concepts/tripwire-cybersecurity-tool/LLD.md",
    "docs/concepts/tripwire-cybersecurity-tool/storage.md",
    "docs/concepts/tripwire-cybersecurity-tool/README.md"
  ]
}
