{
  "prTitle": "feat: implement AlertService RPCs with persistence and WebSocket fan-out",
  "prBody": "## Summary\n\nImplements the gRPC AlertService (Sprint 3, issue #180) that is the primary ingestion endpoint for the TripWire dashboard server.\n\n### What was built\n\n**Proto definition** (`proto/alert.proto`)\n- `AlertService` with `RegisterAgent` (unary) and `StreamAlerts` (bidirectional streaming) RPCs\n- Generated Go code committed to `internal/server/grpc/alertpb/` — builds do not require `protoc`\n\n**gRPC Server** (`internal/server/grpc/server.go`)\n- `RegisterAgent`: upserts host record in PostgreSQL, returns stable UUID + server clock\n- `StreamAlerts`: validates events (tripwire_type, severity, required IDs), persists to PostgreSQL via `BatchInsertAlerts` (batched/buffered), fans out to WebSocket clients\n- Accepts `Store` interface for easy fake injection in tests\n\n**WebSocket Broadcaster** (`internal/server/websocket/broadcaster.go`)\n- In-process fan-out using `sync.Map` of per-client buffered send channels\n- Non-blocking `Broadcast`: slow clients are skipped and their `Dropped` counter is incremented\n- `Register`/`Unregister` lifecycle with clean channel shutdown\n\n**WebSocket Handler** (`internal/server/websocket/handler.go`)\n- RFC 6455 compliant HTTP → WebSocket upgrade using stdlib `net/http` + `http.Hijacker` (zero external WebSocket library dependency)\n- Server-side frame writer with 1-byte, 2-byte, and 8-byte length encoding\n- Client-side frame reader (discards client frames, detects close opcode)\n- Write deadline enforcement per configured timeout\n\n### Tests\n- `internal/server/grpc/server_test.go`: 8 scenarios covering RegisterAgent, StreamAlerts happy path (DB persistence + WS broadcast), validation errors, zero timestamp defaulting, and null event_detail\n- `internal/server/websocket/broadcaster_test.go`: 5 scenarios covering register/unregister, broadcast delivery, drop-on-full-buffer, empty room, and unregister unknown ID\n- `internal/server/websocket/handler_test.go`: 3 scenarios covering non-WS rejection, missing key rejection, and full handshake + broadcast delivery\n\n### Documentation\n- Added `docs/concepts/tripwire-cybersecurity-tool/grpc-alert-service.md` with API reference, integration example, and test coverage table\n\n### go.mod changes\n- Promoted `github.com/google/uuid`, `google.golang.org/grpc`, `google.golang.org/protobuf` from indirect to direct dependencies\n\nCloses #180",
  "testsPass": true,
  "filesChanged": [
    "proto/alert.proto",
    "internal/server/grpc/alertpb/alert.pb.go",
    "internal/server/grpc/alertpb/alert_grpc.pb.go",
    "internal/server/grpc/server.go",
    "internal/server/grpc/server_test.go",
    "internal/server/websocket/broadcaster.go",
    "internal/server/websocket/broadcaster_test.go",
    "internal/server/websocket/handler.go",
    "internal/server/websocket/handler_test.go",
    "go.mod"
  ],
  "docsUpdated": [
    "docs/concepts/tripwire-cybersecurity-tool/grpc-alert-service.md"
  ],
  "docsReviewed": [
    "docs/concepts/tripwire-cybersecurity-tool/HLD.md",
    "docs/concepts/tripwire-cybersecurity-tool/LLD.md",
    "docs/concepts/tripwire-cybersecurity-tool/storage.md",
    "docs/concepts/tripwire-cybersecurity-tool/README.md"
  ]
}
