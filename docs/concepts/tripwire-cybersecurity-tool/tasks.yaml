GeneratedAt: "2026-02-26T08:18:58Z"
Plan: tripwire-cybersecurity-tool-plan
Sprints:
- Features:
  - FeatureID: tripwire-cybersecurity-tool-feat-process-watcher
    FeatureTitle: Process Tripwire Watcher
    Tasks:
    - AcceptanceCriteria:
      - BPF program compiles with clang/bpftool and passes the kernel verifier on
        Linux >=5.8
      - Ring buffer events contain PID, PPID, UID, and null-terminated command line
        (argv joined)
      - Program attaches to both execve and execveat tracepoints
      AgentType: backend-engineer
      Dependencies: []
      Description: Write the eBPF C program that attaches to the execve/execveat syscall
        tracepoints and collects PID, parent PID, UID/GID, and full argv into a ring
        buffer. Define the shared event struct used by both kernel and userspace.
      EstimatedEffort: M
      Files:
      - internal/watcher/ebpf/process.bpf.c
      ID: task-tripwire-cybersecurity-tool-feat-process-watcher-1
      Title: Implement eBPF kernel program for execve tracing
    - AcceptanceCriteria:
      - Loader detects kernel <5.8 and returns ErrNotSupported so callers can fall
        back
      - Ring buffer consumer runs in a goroutine and sends typed events on a channel
        without dropping under burst load
      - Close() detaches the BPF program and frees all resources without leaking goroutines
      AgentType: backend-engineer
      Dependencies:
      - task-tripwire-cybersecurity-tool-feat-process-watcher-1
      Description: Write the Go code that uses cilium/ebpf to load and pin the compiled
        BPF object, reads events from the ring buffer, and converts raw kernel structs
        into typed Go event values. Handle program loading errors and graceful teardown.
      EstimatedEffort: M
      Files:
      - internal/watcher/ebpf/process.go
      ID: task-tripwire-cybersecurity-tool-feat-process-watcher-2
      Title: Implement eBPF Go userspace loader and event pump
    - AcceptanceCriteria:
      - ProcessWatcher implements the Watcher interface and integrates with the agent
        event pipeline
      - eBPF path is selected on Linux >=5.8; ptrace fallback is selected on older
        kernels; unit tests mock both paths
      - Only process names matching the configured watchlist emit alert events; non-matching
        execve events are silently dropped
      - Watch() and Close() are safe to call concurrently; no goroutine leak on shutdown
      AgentType: backend-engineer
      Dependencies:
      - task-tripwire-cybersecurity-tool-feat-process-watcher-2
      Description: Implement the ProcessWatcher struct satisfying the Watcher interface.
        Attempt to start the eBPF loader; on ErrNotSupported or non-Linux platforms
        fall back to a ptrace (Linux) or kqueue (macOS) polling mechanism. Emit alert
        events with PID, PPID, user, and command line filtered against configured
        process names.
      EstimatedEffort: L
      Files:
      - internal/watcher/process_watcher.go
      ID: task-tripwire-cybersecurity-tool-feat-process-watcher-3
      Title: Implement ProcessWatcher with ptrace/kqueue fallback
  - FeatureID: tripwire-cybersecurity-tool-feat-grpc-server
    FeatureTitle: gRPC Alert Ingestion Service
    Tasks:
    - AcceptanceCriteria:
      - gRPC server starts and listens with mTLS; connections without a valid client
        cert are rejected
      - Client cert CN is extracted and available in the gRPC context for each RPC
        call
      - Server wires into cmd/server/main.go with graceful shutdown
      AgentType: backend-engineer
      Dependencies: []
      Description: Set up the gRPC server with mutual TLS configuration, loading server
        and CA certificates from the PKI layer. Implement middleware to extract the
        agent identity from the client certificate Common Name and inject it into
        the request context for downstream handlers.
      EstimatedEffort: M
      Files:
      - cmd/server/main.go
      - internal/server/grpc/server.go
      ID: task-tripwire-cybersecurity-tool-feat-grpc-server-1
      Title: Bootstrap gRPC server with mTLS and cert CN extraction
    - AcceptanceCriteria:
      - RegisterAgent returns a successful response when called with a valid cert
        CN; duplicate registration is idempotent
      - StreamAlerts persists each valid AgentEvent to the alerts table and returns
        an ACK with the generated alert ID
      - Malformed or invalid AgentEvents are rejected with a descriptive error ACK
        and not written to the database
      - Unit tests cover happy path, validation failures, and DB error propagation
      AgentType: backend-engineer
      Dependencies:
      - task-tripwire-cybersecurity-tool-feat-grpc-server-1
      Description: 'Implement the AlertService gRPC handlers: RegisterAgent records
        the agent identity and returns an acknowledgement, StreamAlerts receives a
        bidirectional stream of AgentEvents, validates each event (required fields,
        timestamp bounds, enum values), persists valid alerts to PostgreSQL via the
        storage layer, and sends an ACK response per event. Invalid events receive
        an error ACK without being persisted.'
      EstimatedEffort: L
      Files:
      - internal/server/grpc/alert_service.go
      ID: task-tripwire-cybersecurity-tool-feat-grpc-server-2
      Title: Implement RegisterAgent and StreamAlerts RPC handlers with validation
        and ACK
    - AcceptanceCriteria:
      - Each successfully persisted alert is published to the broadcaster without
        blocking the StreamAlerts goroutine
      - A slow or disconnected WebSocket consumer does not cause back-pressure on
        the gRPC stream
      - Integration test confirms an ingested event appears on a subscribed WebSocket
        connection
      AgentType: backend-engineer
      Dependencies:
      - task-tripwire-cybersecurity-tool-feat-grpc-server-2
      Description: After a valid AgentEvent is persisted, publish the alert to the
        WebSocket broadcaster so connected dashboard clients receive real-time updates.
        Use a non-blocking send (drop or log on full channel) to prevent slow WebSocket
        consumers from stalling the gRPC stream.
      EstimatedEffort: S
      Files:
      - internal/server/grpc/alert_service.go
      ID: task-tripwire-cybersecurity-tool-feat-grpc-server-3
      Title: Fan persisted alerts to WebSocket broadcaster
  - FeatureID: tripwire-cybersecurity-tool-feat-rest-api
    FeatureTitle: REST API
    Tasks:
    - AcceptanceCriteria:
      - Middleware rejects requests missing or malformed Authorization Bearer tokens
        with HTTP 401
      - Middleware validates RS256 signature and token expiry, passing valid requests
        to the next handler
      - Validated JWT claims are stored in request context and accessible by handlers
      AgentType: backend-engineer
      Dependencies: []
      Description: Implement the RS256 JWT bearer token validation middleware in middleware.go.
        The middleware must extract and validate Authorization header tokens using
        RS256 algorithm, reject invalid/expired tokens with 401, and attach claims
        to request context for downstream handlers.
      EstimatedEffort: M
      Files:
      - internal/server/rest/middleware.go
      ID: task-tripwire-cybersecurity-tool-feat-rest-api-1
      Title: Implement RS256 JWT authentication middleware
    - AcceptanceCriteria:
      - GET /healthz returns 200 without authentication; all /api/v1/* routes return
        401 without a valid JWT
      - GET /api/v1/alerts filters results correctly by host, type, severity, and
        time range query parameters
      - GET /api/v1/hosts and GET /api/v1/audit return paginated JSON arrays with
        appropriate HTTP status codes
      - Invalid query parameters return 400 with a descriptive JSON error body
      AgentType: backend-engineer
      Dependencies:
      - task-tripwire-cybersecurity-tool-feat-rest-api-1
      Description: 'Wire up the chi router in router.go and implement all endpoint
        handlers in handlers.go: GET /api/v1/alerts (with host, type, severity, and
        time range query filters), GET /api/v1/hosts, GET /api/v1/audit, and GET /healthz.
        Apply the JWT middleware to all /api routes. Handlers must query the storage
        layer and return JSON responses.'
      EstimatedEffort: M
      Files:
      - internal/server/rest/router.go
      - internal/server/rest/handlers.go
      ID: task-tripwire-cybersecurity-tool-feat-rest-api-2
      Title: Implement chi router and API handlers
  Sprint: 3
- Features:
  - FeatureID: tripwire-cybersecurity-tool-feat-agent-transport
    FeatureTitle: gRPC mTLS Transport Client
    Tasks:
    - AcceptanceCriteria:
      - proto/alert.proto compiles with protoc and both RPCs are present in the generated
        Go bindings
      - AlertEvent message includes all fields required by the LLD (host, timestamp,
        severity, payload)
      - Generated files proto/alert.pb.go and proto/alert_grpc.pb.go are checked in
        and match the proto source
      AgentType: backend-engineer
      Dependencies: []
      Description: Write the alert.proto file defining the StreamAlerts bidirectional
        stream and RegisterAgent unary RPC, including all message types (AlertEvent,
        AgentRegistration, ServerAck). Commit the generated .pb.go and _grpc.pb.go
        files alongside the source proto.
      EstimatedEffort: S
      Files:
      - proto/alert.proto
      - proto/alert.pb.go
      - proto/alert_grpc.pb.go
      ID: task-tripwire-cybersecurity-tool-feat-agent-transport-1
      Title: Define protobuf schema for StreamAlerts and RegisterAgent RPCs
    - AcceptanceCriteria:
      - Client loads mTLS credentials from configured cert/key/CA paths and rejects
        connections with invalid server certificates
      - Exponential backoff retries with configurable base delay and max cap; reconnect_total
        counter increments on each attempt
      - On successful reconnect, all queued alerts are drained from SQLite and sent
        before resuming live streaming
      - Unit tests cover happy-path streaming, reconnect loop, and queue-flush ordering
        using a mock gRPC server
      AgentType: backend-engineer
      Dependencies:
      - task-tripwire-cybersecurity-tool-feat-agent-transport-1
      Description: Implement internal/transport/grpc_client.go with a GRPCClient struct
        that establishes a mTLS connection using agent client certificates, opens
        the StreamAlerts bidirectional stream, and calls RegisterAgent on connect.
        On disconnect, apply exponential backoff before reconnecting and flush the
        SQLite alert queue through the existing queue interface on each successful
        reconnect.
      EstimatedEffort: L
      Files:
      - internal/transport/grpc_client.go
      ID: task-tripwire-cybersecurity-tool-feat-agent-transport-2
      Title: Implement gRPC transport client with mTLS and exponential-backoff reconnection
    - AcceptanceCriteria:
      - All three metrics are registered on the default Prometheus registry and appear
        in /metrics output
      - queue_depth reflects the real-time SQLite queue row count and decreases to
        0 after a flush
      - alerts_sent_total increments once per successfully acknowledged alert sent
        over the stream
      - Integration test verifies metric values after a simulated disconnect-reconnect
        cycle
      AgentType: backend-engineer
      Dependencies:
      - task-tripwire-cybersecurity-tool-feat-agent-transport-2
      Description: Register and instrument the three required Prometheus metrics—queue_depth
        (gauge), alerts_sent_total (counter), reconnect_total (counter)—within the
        GRPCClient. Update queue_depth whenever alerts are enqueued or dequeued, and
        increment the other counters at the appropriate call sites.
      EstimatedEffort: S
      Files:
      - internal/transport/grpc_client.go
      ID: task-tripwire-cybersecurity-tool-feat-agent-transport-3
      Title: Expose Prometheus metrics for transport layer
  - FeatureID: tripwire-cybersecurity-tool-feat-websocket
    FeatureTitle: WebSocket Real-Time Broadcaster
    Tasks:
    - AcceptanceCriteria:
      - Broadcast delivers JSON messages to all registered clients via buffered channels
        without blocking the caller
      - Slow or disconnected clients are evicted without affecting other subscribers
      - Redis pub/sub path activates only when REDIS_URL is configured and falls back
        gracefully when unavailable
      - Unit tests cover fan-out, slow-client eviction, and Redis toggle
      AgentType: backend-engineer
      Dependencies: []
      Description: Implement the Broadcaster struct in broadcaster.go with a sync.Map-based
        client registry and goroutine-driven fan-out. Add a Redis pub/sub subscriber
        path (configurable via env/config) that feeds the same fan-out loop for multi-instance
        scale-out. Expose Register, Unregister, and Broadcast methods.
      EstimatedEffort: M
      Files:
      - internal/server/websocket/broadcaster.go
      ID: task-tripwire-cybersecurity-tool-feat-websocket-1
      Title: Implement in-process channel broadcaster with optional Redis pub/sub
    - AcceptanceCriteria:
      - GET /ws/alerts returns 101 Switching Protocols and receives alert JSON pushed
        within 100 ms of insertion
      - Closing the browser tab cleanly unregisters the client with no goroutine leak
      - Concurrent connections (tested with 50 simultaneous clients) all receive every
        broadcast message
      - Integration test using httptest + gorilla/websocket client verifies end-to-end
        message delivery
      AgentType: backend-engineer
      Dependencies:
      - task-tripwire-cybersecurity-tool-feat-websocket-1
      Description: Implement the ws://dashboard/ws/alerts handler in handler.go that
        upgrades incoming HTTP connections using gorilla/websocket, registers each
        connection with the Broadcaster, and pumps outbound messages until the client
        disconnects or the server shuts down. Wire the handler into the existing router
        and feed new alert events from the DB/alert pipeline into Broadcaster.Broadcast.
      EstimatedEffort: M
      Files:
      - internal/server/websocket/handler.go
      ID: task-tripwire-cybersecurity-tool-feat-websocket-2
      Title: Implement WebSocket HTTP upgrade handler
  - FeatureID: tripwire-cybersecurity-tool-feat-deployment
    FeatureTitle: Deployment & CI/CD
    Tasks:
    - AcceptanceCriteria:
      - docker compose up starts both services and dashboard server passes a /healthz
        check
      - PostgreSQL data is persisted in a named volume and survives container restart
      - Environment variables for DB credentials and TLS cert paths are documented
        and functional
      AgentType: devops-engineer
      Dependencies: []
      Description: Write Dockerfile.server to produce a minimal Go server image and
        a docker-compose.yml that wires the dashboard server together with a PostgreSQL
        service, health checks, and named volumes. The compose file should accept
        environment variables for secrets and expose the gRPC and HTTP/WebSocket ports.
      EstimatedEffort: M
      Files:
      - deployments/Dockerfile.server
      - deployments/docker-compose.yml
      ID: task-tripwire-cybersecurity-tool-feat-deployment-1
      Title: Create Docker Compose stack for dashboard server and PostgreSQL
    - AcceptanceCriteria:
      - systemctl enable && start tripwire.service runs the agent and restarts it
        on failure
      - launchctl load com.tripwire.agent.plist runs the agent under launchd with
        stdout/stderr routed to system log
      - Unit files pass systemd-analyze verify and plutil -lint respectively with
        no errors
      AgentType: devops-engineer
      Dependencies: []
      Description: Create a systemd unit file (tripwire.service) and a launchd plist
        (com.tripwire.agent.plist) that install, start, and supervise the tripwire
        agent binary on Linux and macOS respectively. Both files should set sensible
        security hardening options, restart policies, and log routing.
      EstimatedEffort: S
      Files:
      - deployments/systemd/tripwire.service
      - deployments/launchd/com.tripwire.agent.plist
      ID: task-tripwire-cybersecurity-tool-feat-deployment-2
      Title: Add systemd and launchd service units for agent lifecycle management
    - AcceptanceCriteria:
      - Workflow triggers on tag push and produces four distinct binary artifacts
        with correct GOOS/GOARCH naming
      - All four binaries are statically linked (file output shows 'statically linked'
        or 'Mach-O' with no dylib deps beyond libSystem)
      - Binaries are attached to the GitHub Release created by the workflow
      AgentType: devops-engineer
      Dependencies: []
      Description: Write a GitHub Actions workflow that uses a matrix strategy to
        produce statically-compiled agent binaries for linux/amd64, linux/arm64, darwin/amd64,
        and darwin/arm64 using CGO_ENABLED=0 and appropriate GOARCH/GOOS settings.
        Binaries should be uploaded as release artifacts and attached to GitHub Releases
        on tag push.
      EstimatedEffort: M
      Files:
      - .github/workflows/build.yml
      ID: task-tripwire-cybersecurity-tool-feat-deployment-3
      Title: Implement GitHub Actions build matrix for cross-compiled agent release
        artifacts
  Sprint: 4
